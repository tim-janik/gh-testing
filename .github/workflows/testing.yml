# This Source Code Form is licensed MPL-2.0: http://mozilla.org/MPL/2.0

# Linting: xclip -sel c <.github/workflows/testing.yml # https://rhysd.github.io/actionlint/

on:
  push:
    branches: ['master', 'trunk', 'wip/**']
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+*'

jobs:


  Focal-CI:
    runs-on: ubuntu-latest
    container: { image: 'ghcr.io/tim-janik/anklang-ci:focal-latest' }
    steps:
    - run: cat /etc/passwd
    - run: env
    - run: id
    - run: echo 'passwd home:' $(env -i bash -c 'echo ~')
    - run: echo HOME=$HOME
    - run: echo '~:' ~
    - run: |
        sudo chown -R `id -u`:`id -g` . ~	;# /github/home - actions/runner/issues/863
        export HOME=$(env -i bash -c 'echo ~') && echo HOME=$HOME | sudo tee -a $GITHUB_ENV
        ! [[ $RUNNER_TEMP =~ _ ]] || sudo chmod -R 0777 $RUNNER_TEMP	;# needed for GitHub cache action
        echo HOME=$HOME
        echo '~:' ~
    - run: echo HOME=$HOME
    - run: echo '~:' ~
    - run: ls -al /home
    - run: ls -al ~
    - run: ls -al $RUNNER_TEMP
    - run: id && pwd && ls -ald . ~ $HOME $RUNNER_TEMP
    - { uses: actions/checkout@v4.1.1,  with: { fetch-depth: 0 } } # Fix actions/checkout#290
